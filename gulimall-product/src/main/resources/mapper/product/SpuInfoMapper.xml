<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gulimall.product.mapper.SpuInfoMapper">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.gulimall.product.entity.SpuInfoEntity" id="spuInfoMap">
        <result property="id" column="id"/>
        <result property="spuName" column="spu_name"/>
        <result property="spuDescription" column="spu_description"/>
        <result property="catalogId" column="catalog_id"/>
        <result property="brandId" column="brand_id"/>
        <result property="weight" column="weight"/>
        <result property="publishStatus" column="publish_status"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>


    <select id="queryPage" resultType="com.gulimall.product.vo.SpuInfoVO">
        SELECT
            t1.id, t1.spu_name, t1.spu_description, t1.publish_status, t1.create_time, t1.update_time,
            t2.cat_id AS 'catalog_id', t2.name AS catalog_name, t3.name AS brand_name
        FROM
            pms_spu_info AS t1
            LEFT JOIN pms_category AS t2 ON t1.catalog_id = t2.cat_id
            LEFT JOIN pms_brand AS t3 ON t1.brand_id = t3.brand_id
        <if test="spuQueryDTO != null">
            <where>
                <if test="spuQueryDTO.catalogId != null">
                    t1.catalog_id = #{spuQueryDTO.catalogId}
                </if>
                <if test="spuQueryDTO.brandId != null">
                    AND t1.brand_id = #{spuQueryDTO.brandId}
                </if>
                <if test="spuQueryDTO.publishStatus != null">
                    AND t1.publish_status = #{spuQueryDTO.publishStatus}
                </if>
                <if test="spuQueryDTO.keyword != null and spuQueryDTO.keyword != ''">
                    AND (
                        t1.spu_name LIKE CONCAT('%', #{spuQueryDTO.keyword}, '%') OR
                        t1.spu_description LIKE CONCAT('%', #{spuQueryDTO.keyword}, '%')
                    )
                </if>
            </where>
        </if>
    </select>


</mapper>
