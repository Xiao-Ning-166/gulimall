<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gulimall.storage.mapper.PurchaseDetailMapper">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.gulimall.storage.entity.PurchaseDetailEntity" id="purchaseDetailMap">
        <result property="id" column="id"/>
        <result property="purchaseId" column="purchase_id"/>
        <result property="skuId" column="sku_id"/>
        <result property="skuNum" column="sku_num"/>
        <result property="skuPrice" column="sku_price"/>
        <result property="wareId" column="ware_id"/>
        <result property="status" column="status"/>
    </resultMap>

    <select id="queryPage" resultType="com.gulimall.storage.vo.PurchaseNeedVO">
        SELECT
            t1.id, t1.sku_id, t1.sku_num, t1.sku_price, t2.id AS 'ware_id', t2.name AS 'ware_name', t1.status
        FROM
            wms_purchase_detail AS t1
            LEFT JOIN wms_ware_info AS t2 ON t1.ware_id = t2.id
        <where>
            <if test="purchaseNeedDTO.storageId != null and purchaseNeedDTO.storageId != ''">
                t1.ware_id = #{purchaseNeedDTO.storageId}
            </if>
            <if test="purchaseNeedDTO.status != null">
                AND t1.status = #{purchaseNeedDTO.status}
            </if>
            <if test="purchaseNeedDTO.keyword != null and purchaseNeedDTO.keyword != ''">
                AND (
                    t1.purchase_id = #{purchaseNeedDTO.keyword} OR
                    t1.sku_id = #{purchaseNeedDTO.keyword} OR
                    t1.sku_num = CONCAT('%', #{purchaseNeedDTO.keyword}, '%')
                )
            </if>
        </where>
    </select>

</mapper>
